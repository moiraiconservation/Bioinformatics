<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hedron Project 3</title>
	<meta content="script-src 'self' 'unsafe-inline';" http-equiv="Content-Security-Policy" />
	<script src="element.js" type="text/javascript"></script>
	<script src="pather.js" type="text/javascript"></script>
	<script src="project.js" type="text/javascript"></script>
	<script src="wrapper.js" type="text/javascript"></script>
	<script src="js/alignment.js" type="text/javascript"></script>
	<script src="js/clustal.js" type="text/javascript"></script>
	<script src="js/codons.js" type="text/javascript"></script>
	<script src="js/csv.js" type="text/javascript"></script>
	<script src="js/isoforms.js" type="text/javascript"></script>
	<script src="js/orthologs.js" type="text/javascript"></script>
	<script src="js/sequences.js" type="text/javascript"></script>
	<script src="js/tree.js" type="text/javascript"></script>
	<script src="js/tsv.js" type="text/javascript"></script>
	<script src="js/scoring_matrices.js" type="text/javascript"></script>
	<script src="js/stats.js" type="text/javascript"></script>
	<link href="https://fonts.gstatic.com" rel="preconnect">
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Nova+Mono&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono&display=swap" rel="stylesheet">
	<link href="node_modules/@fortawesome/fontawesome-free/css/all.css" rel="stylesheet" type="text/css">
	<link href="styles/bootstrap_3_3_7.css" rel="stylesheet" type="text/css">
	<link href="theme.css" rel="stylesheet" type="text/css">
</head>
<body>
	<div class="container-fluid">
		<div class="container">
			<div style="height: 25px"></div>
			<div style="height: 25px"></div>
			<div class="center">
				<div class="document document_medium">
					<div id="output-title"></div>
				</div>
			</div>
		</div> <!-- end container -->
	</div> <!-- end container-fluid -->
	<script>
		///////////////////////////////////////////////////////////////////////////
		// NOTES FOR FUTURE USE ///////////////////////////////////////////////////
		//
		//	Load the protein FASTA files first, then load the CDS files.  These
		//	files must be loaded in that order.
		//
		///////////////////////////////////////////////////////////////////////////
		// REQUIRED OBJECTS ///////////////////////////////////////////////////////

		const element = new ELEMENT();
		const pather = new PATHER();
		const wrapper = new WRAPPER();

		///////////////////////////////////////////////////////////////////////////
		// OPTIONAL OBJECTS ///////////////////////////////////////////////////////

		const alignment = new ALIGNMENT();
		const clustal = new CLUSTAL();
		const codons = new CODONS();
		const isoforms = new ISOFORMS();
		const ortho_creator = new ORTHO_CREATOR();
		const project = new PROJECT();
		const sequences = new SEQUENCES();
		const stats = new STATS();
		const tree = new TREE();
		const tsv = new TSV();

		///////////////////////////////////////////////////////////////////////////
		// APPLICATION STORAGE AND PROJECT SETTINGS ///////////////////////////////

		var app_storage;
		wrapper.get_app_storage().then((result) => {
			app_storage = result;
			project.set_directory(app_storage.project_directory).then(() => {
				app_storage.project_directory = project.directory;
				wrapper.set_app_storage(app_storage);
			});
		});

		///////////////////////////////////////////////////////////////////////////
		// VARIABLES //////////////////////////////////////////////////////////////
	
		var orthologs;

		///////////////////////////////////////////////////////////////////////////
		// IPC COMMUNICATION //////////////////////////////////////////////////////

		window.api.receive('fromMain', async (arg) => {
			if (arg.command) {
				switch (arg.command) {

					case 'open_blast': {
						if (arg.data && arg.data.filePaths.length) {
							ortho_creator.add_blast_files(arg.data.filePaths);
							orthologs = await ortho_creator.create(project.folders);
							console.log('loaded');
							if (orthologs.is_loaded()) {
								console.log(orthologs);
							}
						}
						break;
					}

					case 'open_cds': {
						if (arg.data && arg.data.filePaths.length) {
							ortho_creator.add_cds_files(arg.data.filePaths);
							orthologs = await ortho_creator.create(project.folders);
							console.log('loaded');
							if (orthologs.is_loaded()) {
								console.log(orthologs);
							}
						}
						break;
					}

					case 'open_compact_isoforms': {
						if (arg.data && arg.data.filePaths.length) {
							ortho_creator.add_isoform_files(arg.data.filePaths);
							orthologs = await ortho_creator.create(project.folders);
							console.log('loaded');
							if (orthologs.is_loaded()) {
								console.log(orthologs);
								await orthologs.create_isoform_files(project.folders);
							}
						}
						break;
					}

					case 'open_project_folder': {
						if (arg.data && arg.data.filePaths.length) {
							await project.set_directory(arg.data.filePaths[0]);
							app_storage.project_directory = project.directory;
							await wrapper.set_app_storage(app_storage);
						}
						break;
					}

					case 'open_protein': {
						if (arg.data && arg.data.filePaths.length) {
							ortho_creator.add_protein_files(arg.data.filePaths);
							orthologs = await ortho_creator.create(project.folders);
							console.log('loaded');
							if (orthologs.is_loaded()) {
								console.log(orthologs);
							}
						}
						break;
					}

					case 'open_rbh': {
						if (arg.data && arg.data.filePaths.length) {
							ortho_creator.add_rbh_files(arg.data.filePaths);
							orthologs = await ortho_creator.create(project.folders);
							console.log('loaded');
							if (orthologs.is_loaded()) {
								console.log(orthologs);
								await orthologs.create_isoform_files(project.folders);
							}
						}
						break;
					}

				}
			}
		});

	</script>
</body>
</html>